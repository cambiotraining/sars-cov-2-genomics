<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SARS Genomic Surveillance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../materials/03-case_studies/01-switzerland.html" rel="next">
<link href="../../materials/02-isolates/03-lineages.html" rel="prev">
<link href="../../site_libs/quarto-contrib/quarto-project/cambiotraining/courseformat/img/university-of-cambridge-favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../site_libs/quarto-contrib/quarto-project/cambiotraining/courseformat/img/university_crest_reversed.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Bioinformatics for SARS Genomic Surveillance</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cambiotraining/sars-cov-2-genomics" rel="" target=""><i class="bi bi-github" role="img" aria-label="Bioinformatics Training Facility GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/bioinfocambs" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Bioinformatics Training Facility Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://genomic.social/@BioInfoCambs" rel="" target=""><i class="bi bi-mastodon" role="img" aria-label="Bioinformatics Training Facility Mastodon">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../materials/02-isolates/01-consensus.html">Clinical Isolates</a></li><li class="breadcrumb-item"><a href="../../materials/02-isolates/04-phylogeny.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Building phylogenetic trees</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data &amp; Software</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/01-intro/01-surveillance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">SARS-CoV-2 genomic surveillance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/01-intro/02-ngs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to NGS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/01-intro/03-workflows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bioinformatic workflows</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Clinical Isolates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/02-isolates/01-consensus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Consensus assembly</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/02-isolates/02-qc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Quality Control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/02-isolates/03-lineages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lineages and variants</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/02-isolates/04-phylogeny.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Building phylogenetic trees</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Case Studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/03-case_studies/01-switzerland.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Switzerland (Nanopore)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/03-case_studies/02-southafrica.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">South Africa (Illumina)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/03-case_studies/03-eqa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">EQA (Exercise)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Wastewater Samples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/04-wastewater/01-ww_surveillance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Wastewater Surveillance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/04-wastewater/02-ww_abundance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lineage Abundance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/04-wastewater/03-ww_visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Abundance Visualisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/04-wastewater/04-ww_mutations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mutation Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Software</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/05-software/01-managing_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Managing Bioinformatics Software</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/05-software/03-software_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Software setup</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/appendices/file_formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Common file formats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/appendices/unix_cheatsheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unix cheat sheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/appendices/quick_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R fundamentals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/appendices/tools_and_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tools and Resources</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-phylogeny" id="toc-sec-phylogeny" class="nav-link active" data-scroll-target="#sec-phylogeny"><span class="header-section-number">7.1</span> SARS-CoV-2 Phylogeny</a></li>
  <li><a href="#sec-mafft" id="toc-sec-mafft" class="nav-link" data-scroll-target="#sec-mafft"><span class="header-section-number">7.2</span> Alignment</a>
  <ul class="collapse">
  <li><a href="#visualising-alignments" id="toc-visualising-alignments" class="nav-link" data-scroll-target="#visualising-alignments"><span class="header-section-number">7.2.1</span> Visualising alignments</a></li>
  </ul></li>
  <li><a href="#sec-iqtree" id="toc-sec-iqtree" class="nav-link" data-scroll-target="#sec-iqtree"><span class="header-section-number">7.3</span> Tree Inference: IQ-Tree</a></li>
  <li><a href="#sec-figtree" id="toc-sec-figtree" class="nav-link" data-scroll-target="#sec-figtree"><span class="header-section-number">7.4</span> Visualising Trees</a></li>
  <li><a href="#time-scaled-phylogenies" id="toc-time-scaled-phylogenies" class="nav-link" data-scroll-target="#time-scaled-phylogenies"><span class="header-section-number">7.5</span> Time-scaled Phylogenies</a></li>
  <li><a href="#missing-data-problematic-sites" id="toc-missing-data-problematic-sites" class="nav-link" data-scroll-target="#missing-data-problematic-sites"><span class="header-section-number">7.6</span> Missing Data &amp; Problematic Sites</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">7.7</span> Exercises</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">7.8</span> Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Building phylogenetic trees</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Understand the basics of how phylogeny trees are constructed using maximum likelihood methods.</li>
<li>Describe what branch lengths represent in typical SARS-CoV-2 phylogenetic tree.</li>
<li>Recognise the limitations and challenges in building phylogenies for SARS-CoV-2.</li>
<li>Use <em>MAFFT</em> to produce a multiple sequence alignment.</li>
<li>Use <em>IQ-Tree</em> for phylogenetic tree inference.</li>
<li>Use <em>TimeTree</em> to obtain time-scaled phylogenetic trees using sample collection date metadata.</li>
</ul>
</div>
</div>
<!-- :::{.callout-note}
#### Slides

This section has an accompanying <a href="https://drive.google.com/file/d/19MCiM8JhWgtSwvQdotfJRlyv7Z7CVJwz/view?usp=sharing" target="_blank">slide deck</a>.
::: -->
<!--
## Phylogenetics Basics

TODO: 

- brief intro to phylogenetics, based on Nicola's presentation. 
- Mention interpretation of branch length in particular SARS-CoV-2 has ~2 mutations per month (probably replication errors), leading to very short branch lengths and polytomies. 
- Note about bootstraping - should probably be avoided, since there are usually too few sites for meaningful results. 


- Multifurcations happen when several samples have the same sequence, so the branch lengths between them are zero, so they all collapse to a single node. This can happen for example if you have a local outbreak of a variant where every sample has the same variant.
- Recombination can cause problems in phylogenies. This is when two viral sequences recombine with each other, so now the new sequence has part of its genome closely-related to one parent and the other from the other parent. This can cause problems with phylogenetic trees. There are software that can detect recombination events. In particular the software RIPPLES can work with large sample sizes.

### Alignment

To build a phylogenetic tree we need to start with all our sequences aligned to each other. 
The alignment might result in _gaps_ in some sequences, where missing nucleotides in some sequences are represented with `-` character. 
The alignment is usually stored as a FASTA file, and all sequences have to be of the same length (because they are aligned to each other). 

Gaps (`-`) and ambiguous positions (`N`) are treated as missing data by the phylogenetic methods. 

Something to note is that phylogenetic inference assumes that the alignments we give are correct. 
However, errors in the consensus sequence or missing data can sometimes lead to poor alignments.
One thing to pay attention to is whether there are very long branches in our trees, suggesting a sample with an unusual high number of mutations. 
Inspecting these samples may reveal errors in the alignment, for example due to high proportion of missing data that leads to poor alignments, which may result in false variable positions. 

Other errors are harder to detect but work from Turakaia et al was able to build a collection of recurrent errors that affect phylogenies.


### Tree Inference

There are broadly three types of methods: 

- distance
- parsimony
- maximum likelihood

#### Distance Phylogenies

These methods rely on calculating the distance between each pair of sequences.
Popular methods of this kind are _neighbour-joining_ (NJ) or 

#### Maximum Parsimony

Infers a tree that requires the fewest number of mutations needed along each branch of the tree to explain the data. 

This method can be inaccurate when there are long branches in the tree (this problem is referred to as "long branch attaction"). 
However, for SARS-CoV-2 this is not a big problem, because the sequences tend to be very similar to each other. 

In fact, a recent tool called _UShER_ has been developed for SARS-CoV-2 analysis using a parsimony-based method. 
This tool was developed to be very efficient at working with millions of samples, which is harder with maximum likelihood methods. 

#### Maximum Likelihood

- Uses a probabilistic model for genome evolution.
- Model of evolution:
  - DNA substituion model
    - JC69 assumes only one mutation rate
    - HKY85 assumes different mutation rates (transitions have different rates)
    - GTR is another one
  - Rate heterogeneity:
    - Invariant sites - the model will assume that a certain proportion of the sites in the genome might never change.
    - Rate variation (Gamma models used) - the model will assume that different sites of the genome might evolve at different rates.
- Generally, more complex models give better results (but are more computationally demanding and require more data)
-  
-->
<section id="sec-phylogeny" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="sec-phylogeny"><span class="header-section-number">7.1</span> SARS-CoV-2 Phylogeny</h2>
<p><img src="https://raw.githubusercontent.com/roblanf/sarscov2phylo/master/tree_image.jpg" alt="Global Phylogeny" style="float:right;width:20%"></p>
<p>Building phylogenetic trees for SARS-CoV-2 is challenging due to the large number of sequences available, with <a href="https://www.gisaid.org/index.php?id=208">millions of genomes submited to GISAID</a> to this day. This means that using maximum-likelihood inference tools to build a global SARS-CoV-2 phylogeny is both time-consuming and computationally demanding.</p>
<p>However, several researchers have dedicated their time to identifying tools and models suitable for the phylogenetic analysis of this organism. For example, the <a href="https://github.com/roblanf/sarscov2phylo">global phylogenies repository</a> from Rob Lanfear provide with several tips on building phylogenetic trees for this organism. Their trees are regularly updated and available to download from the GISAID website (which requires an account).</p>
<p>Global phylogenies are also available from the groups of Russell Corbett-Detig and Yatish Turakhia, who have developed <a href="https://doi.org/10.1093/molbev/msab264">efficient methods and tools</a> for dealing with large phylogenies. These tools include <em>UShER</em> and <em>matUtils</em>, introducing a new and efficient file format for storing phylogenetic trees, mutations and other annotations (such as lineages) called <em>mutation-annotated trees</em> (MAT format). Their phylogenies are updated daily and are <a href="http://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2/">publicly available for download</a>. (Note: Course materials covering these tools are still under development.)</p>
<p>Two popular tools used for phylogenetic inference via maximum-likelihood are <strong><em>FastTree</em></strong> and <strong><em>IQ-Tree</em></strong>. Generally, when building a tree from a collection of samples you can include the Wuhan-Hu-1 reference sequence as an outgroup to root the tree. Optionally, you can also add a collection of sequences from around the world (and across time) to contextualise your samples in the global diversity.</p>
<p>As an input, these programs need a <em>multiple sequence alignment</em> FASTA file, which is where we start our analysis.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data for this section
</div>
</div>
<div class="callout-body-container callout-body">
<p>We will work from the course materials folder called <code>04-phylogeny</code>, which contains the following files:</p>
<ul>
<li><code>data/uk_consensus.fa</code> and <code>data/india_consensus.fa</code> are consensus sequences from the UK and India, respectively. These are the sequences previously assembled using the <code>nf-core/viralrecon</code> pipeline.</li>
<li><code>sample_annotation.tsv</code> is a tab-separated values (TSV) file with information about each sample such as the date of collection and lineage/clade they were assiged to from our analysis. We will use this table to annotate our phylogenetic trees. This table can also be opened in a spreadsheet program such as Excel.</li>
<li><code>resources/reference/sarscov2.fa</code> is the reference genome.</li>
</ul>
</div>
</div>
</section>
<section id="sec-mafft" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="sec-mafft"><span class="header-section-number">7.2</span> Alignment</h2>
<p>The first step in building a phylogenetic tree is to produce a multiple sequence alignment from all our consensus sequences. This is the basis for building a phylogenetic tree from the positions that are variable across samples.</p>
<p>A widely used multiple sequence alignment software is called <strong><em>MAFFT</em></strong>. For SARS-CoV-2, a reference-based alignment approach is often used, which is suitable for closely-related genomes. MAFF provides this functionality, which is detailed in its <a href="https://mafft.cbrc.jp/alignment/software/closelyrelatedviralgenomes.html">documentation</a>.</p>
<p>We demonstrate the analysis using the UK samples in our course materials. First, start by creating a directory for the output:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> results/mafft</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, we run the command to generate a reference-based alignment:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mafft</span> <span class="at">--6merpair</span> <span class="at">--maxambiguous</span> 0.2 <span class="at">--addfragments</span> data/uk_consensus.fa resources/reference/sarscov2.fa <span class="op">&gt;</span> results/mafft/uk_alignment.fa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The meaning of the options used is:</p>
<ul>
<li><code>--6merpair</code> is a fast method for estimating the distances between sequences, based on the number of short 6bp sequences shared between each pair of sequences. This is less accurate than other options available (like <code>--localpair</code> and <code>--globalpair</code>), but runs much faster in whole genome data like we have.</li>
<li><code>--maxambiguous 0.2</code> automatically removes samples with more than 20% ambiguous ‘N’ bases (or any other value of our choice). This is a convenient way to remove samples with poor genome coverage from our analysis.</li>
<li><code>--addfragments data/consensus_sequences.fa</code> is the FASTA file with the sequences we want to align.</li>
<li>finally, at the end of the command we give the reference genome as the input sequence to align our sequences against.</li>
</ul>
<p>MAFFT provides several other methods for alignment, with tradeoffs between speed and accuracy. You can look at the full documentation using <code>mafft --man</code> (<code>mafft --help</code> will give a shorter description of the main options). For example, from its documentation we can see that the most precise alignment can be obtained with the options <code>--localpair --maxiterate 1000</code>. However, this is quite slow and may not be feasible for whole genome data of SARS-CoV-2.</p>
<section id="visualising-alignments" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="visualising-alignments"><span class="header-section-number">7.2.1</span> Visualising alignments</h3>
<p>We can visualise our alignment using the software <a href="https://ormbunkar.se/aliview/">AliView</a>, which is both lightweight and fast, making it ideal for large alignments. Visualising the alignment can be useful for example to identify regions with missing data (more about this below).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/alignment_aliview.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Snapshop of an alignment visualised with AliView. In this case we are looking at the end of the alignment of our sequences, which shows a typical high number of missing (‘N’) bases.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Other Alignment Strategies
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are other commonly used alignment tools used for SARS-CoV-2 genomes:</p>
<ul>
<li>The <a href="https://lh3.github.io/minimap2/"><code>minimap2</code></a> software has been designed for aligning long sequences to a reference genome. It can therefore be used to align each consensus sequence to the Wuhan-Hu-1 genome. This is the tool internally used by <em>Pangolin</em>.</li>
<li><em>Nextclade</em> uses an internal alignment algorithm where each consensus sequence is aligned with the reference genome. The alignment produced from this tool can also be used for phylogenetic inference.</li>
</ul>
<p>It is worth mentioning that when doing reference-based alignment, insertions relative to the reference genome are not considered.</p>
</div>
</div>
</section>
</section>
<section id="sec-iqtree" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="sec-iqtree"><span class="header-section-number">7.3</span> Tree Inference: IQ-Tree</h2>
<p><em>IQ-TREE</em> supports <a href="http://www.iqtree.org/doc/Substitution-Models">many substitution models</a>, including models with <em>rate heterogeneity</em> across sites.</p>
<p>Let’s start by creating an output directory for our results:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> results/iqtree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And then run the program with default options (we set <code>--prefix</code> to ensure output files go to the directory we just created and are named “uk”):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">iqtree2</span> <span class="at">-s</span> results/mafft/uk_alignment.fa <span class="at">--prefix</span> results/iqtree/uk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Without specifying any options, <code>iqtree2</code> uses <a href="https://www.nature.com/articles/nmeth.4285"><em>ModelFinder</em></a> to find the substituion model that maximizes the likelihood of the data, while at the same time taking into account the complexity of each model (using information criteria metrics commonly used to assess statistical models).</p>
<p>From the information printed on the console after running the command, we can see that the chosen model for our alignment was “GTR+F+I”, a <a href="https://en.wikipedia.org/wiki/Substitution_model#Generalised_time_reversible"><em>generalised time reversible</em> (GTR) substitution model</a>. This model requires an estimate of each base frequency in the population of samples, which in this case is estimated by simply counting the frequencies of each base from the alignment (this is indicated by “+F” in the model name). Finally, the model includes rate heterogeneity across sites, allowing for a proportion of invariant sites (indicated by “+I” in the model name). This makes sense, since we know that there are a lot of positions in the genome where there is no variation in our samples.</p>
<p>We can look at the output folder (specified with <code>--prefix</code>) where we see several files with the following extension:</p>
<ul>
<li><code>.iqtree</code> - a text file containing a report of the IQ-Tree run, including a representation of the tree in text format.</li>
<li><code>.treefile</code> - the estimated tree in NEWICK format. We can use this file with other programs, such as <em>FigTree</em>, to visualise our tree.</li>
<li><code>.log</code> - the log file containing the messages that were also printed on the screen.</li>
<li><code>.bionj</code> - the initial tree estimated by neighbour joining (NEWICK format).</li>
<li><code>.mldist</code> - the maximum likelihood distances between every pair of sequences.</li>
<li><code>ckp.gz</code> - this is a “checkpoint” file, which IQ-Tree uses to resume a run in case it was interrupted (e.g.&nbsp;if you are estimating very large trees and your job fails half-way through).</li>
<li><code>.model.gz</code> - this is also a “checkpoint” file for the model testing step.</li>
</ul>
<p>The main files of interest are the report file (<code>.iqtree</code>) and the NEWICK tree file (<code>.treefile</code>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Inference of very large trees
</div>
</div>
<div class="callout-body-container callout-body">
<p>Although running <em>IQ-Tree</em> with default options is fine for most applications, there will be some bottlenecks once the number of samples becomes too large. In particular, the <em>ModelFinder</em> step may be very slow and so it’s best to set a model of our choice based on other people’s work. For example, <a href="https://github.com/roblanf/sarscov2phylo/blob/13-11-20/tree_estimation.md#which-model-is-best">work by Rob Lanfear</a> suggests that models such as “GTR+G” and “GTR+I” are suitable for SARS-CoV-2. We can specify the model used by <code>iqtree2</code> by adding the option <code>-m GTR+G</code>, for example.</p>
<p>For very large trees (over 10k or 100k samples), using an alternative method to place samples in an existing phylogeny may be more adequate. <a href="https://usher-wiki.readthedocs.io/en/latest/"><em>UShER</em></a> is a popular tool that can be used to this end. It uses a parsimony-based method, which tends to perform well for SARS-CoV-2 phylogenies.</p>
</div>
</div>
</section>
<section id="sec-figtree" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="sec-figtree"><span class="header-section-number">7.4</span> Visualising Trees</h2>
<p>There are many programs that can be used to visualise phylogenetic trees. In this course we will use <em>FigTree</em>, which has a simple graphical user interface.</p>
<p>To open the tree, go to <kbd><kbd>File</kbd> &gt; <kbd>Open…</kbd></kbd> and browse to the folder with the IQ-Tree output files. Select the file with <code>.treefile</code> extension and click <kbd>Open</kbd>. You will be presented with a visual representation of the tree.</p>
<p>We can also import a “tab-separated values” (TSV) file with annotations to add to the tree. For example, we can use our results from <em>Pangolin</em> and <em>Nextclade</em>, as well as other metadata to improve our visualisation (we have prepared a TSV with this information combined, which you could do using Excel or another spreadsheet software).</p>
<ul>
<li>Go to <kbd><kbd>File</kbd> &gt; <kbd>Import annotations…</kbd></kbd> and open the annotation file.</li>
<li>On the menu on the left, click <kbd>Tip Labels</kbd> and under “Display” choose one of the fields of our metadata table. For example, you can display the lineage assigned by <em>Pangolin</em> (“pango_lineage” column of our annotation table).</li>
</ul>
<p>There are many ways to further configure the tree, including highlighting clades in the tree, and change the labels. See the figure below for an example.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/phylogeny_figtree.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Annotated phylogenetic tree obtained with FigTree. We used the lineage of each sample as our tip labels and aligned the labels on the right (check the tickbox at the top of the left menu called “Align tip labels”). We identified two clades in the tree that corresponded to the Alpha and Delta variants, and used the “Highlight” tool to give them different colours. To do this, change the “Selection Mode” at the top to “Clade”, then select the branch at the base of the clade you want to highlight, and press the “Highlight” button on the top to pick a colour.</figcaption>
</figure>
</div>
<!-- 
From [here](https://github.com/roblanf/sarscov2phylo/issues/20#issuecomment-855319059):

```bash
iqtree2 -s aln.fasta -t NJ-R -n 0 -m GTR+R4 -nt 8 -blmin 0.00000000001
```

Although if we run with default options, it will use _ModelFinder Plus_ to identify best model (based on AIC):

```bash
iqtree -s aln.fasta -nt 8 -blmin 0.00000000001
```

This takes quite a while to run though. 

NOTE:
- In `iqtree2` the option `-nt` (number threads) is now `-T`. The default auto-detects so we could leave it out.
- Running `fasttree` results in a strange tree with a "laddering" effect. Running `iqtree` with `-blmin` set to a small number solves this somewhat.


### FastTree

From [here](https://github.com/roblanf/sarscov2phylo/commit/55cbb8ddaddaceb2ecd0577f105a3fd37f13d304), I think these are run with performance in mind:

```bash
fasttree -nt -gamma -nosupport \
  -sprlength 500 -nni 0 -spr 5 \
  -refresh 0.8 -topm 1.5 -close 0.75 -noml \
  "$INPUT_FASTA" > "$INPUT_FASTA"'1.multi.fasttree'
    
fasttree -nt -gamma -sprlength 200 -spr 5 -intree \
  "$INPUT_FASTA"'1.multi.fasttree' \
  "$INPUT_FASTA" > "$INPUT_FASTA"'multi.fasttree'
```

In this document there's a much simpler command, which is probably fine for the purpose of our course: 

```bash
fasttree -nt -nosupport input.fa > output.tree 2> output.log
```

**NOTE to self:** ran this with additional `-gtr` option and took 6 minutes. 

- `-nt` for nucleotide alignment (default is protein alignment).
- `-nosupport` to turn off support values (bootstrap) - it makes sense to turn this off, since we often have very few variable sites to bootstrap from.

We can visualise the tree we just produced with _FigTree_. 
We can also import the output from _Pangolin_ to annotate our tree by variant (**note:** unfortunately FigTree wants a TSV file, but pangolin exports CSV. I did this, but maybe there's a less confusing way to do this? `cat results/pangolin/run1_report.csv | sed 's|,|\t|g' > results/pangolin/run1_report.tsv`)


:::{.callout-exercise}

- Looking at the tree we just constructed, do you think the Delta variant emerged from the Alpha variant?
- Produce a new phylogenetic tree but this time using both the sequences we processed and a sample of other public sequences that represent the global diversity of SARS-CoV-2 genomes. 
  - First combine the two files into one (`cat`).
  - Produce a combined annotation file with sequence name and lineage.
  - Then run `fasttree` with the same settings we used before.
- Visualise this new tree. Does your conclusion change?

:::

Alignment: MAFFT is used [here](https://github.com/roblanf/sarscov2phylo/blob/master/scripts/global_profile_alignment.sh) `mafft --thread 1 --quiet --keeplength --add $seqfile "$REFERENCE_ALN" > $alfile` 

-->
</section>
<section id="time-scaled-phylogenies" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="time-scaled-phylogenies"><span class="header-section-number">7.5</span> Time-scaled Phylogenies</h2>
<p>The trees that we build from sequence data are scaled using the mutation rate estimated from the sequence alignments. This is useful if we want to know, for example, on average how many mutations separate different branches of the tree.</p>
<p>Another way to scale trees is to use time. For viral genome sequences, we usually have information about their date of collection, and this can be used to scale the phylogeny using the date information. The idea is to rescale the trees such that the x-axis of the tree represents a date rather than number of mutations.</p>
<p>Two programs that can be used to time-scale trees using date information are called <a href="https://treetime.readthedocs.io/en/latest/index.html"><em>TreeTime</em></a> and <a href="https://www.biorxiv.org/content/10.1101/2021.10.27.465994v1"><em>Chronumental</em></a>. <em>Chronumental</em> was developed for dealing with very large phylogenies (millions of samples), but lacks some of the functionalities provided by <em>TreeTime</em> (such as estimating uncertainty in date estimates, reconstructing past sequences, re-rooting trees, among others). So, if you are working with less than ~50,000 sequences, we recommend using <em>TreeTime</em>, otherwise <em>Chronumental</em> is a suitable alternative.</p>
<p>Because we are dealing with a small number of samples, we will show an example of using <em>TreeTime</em> to scale our tree based on our dates:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">treetime</span> <span class="at">--tree</span> results/iqtree/uk.treefile <span class="at">--dates</span> sample_annotation.tsv <span class="at">--aln</span> results/mafft/uk_alignment.fa <span class="at">--outdir</span> results/treetime/uk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After running, this tool produces several output files in the specified folder. The main files of interest are:</p>
<ul>
<li><code>timetree.nexus</code> is the new date-scaled tree. <a href="https://en.wikipedia.org/wiki/Nexus_file">NEXUS</a> is another tree file format, which can store more information about the tree compared to the simpler NEWICK format. This format is also supported by <em>FigTree</em>.</li>
<li><code>timetree.pdf</code> is a PDF file with the inferred tree, including a time scale on the x-axis. This can be useful for quick visualisation of the tree.</li>
</ul>
<p>We can visualise this tree in <em>FigTree</em>, by opening the file <code>timetree.nexus</code>. The scale of this new tree now corresponds to years (instead of nucleotide substitution rates). We make make several adjustments to this tree, to make it look how we prefer. For example:</p>
<ul>
<li>Label the nodes of the tree with the inferred dates: from the left menu click <kbd>Node Labels</kbd> and under “Display” select “date”.</li>
<li>Import the metadata table (<code>sample_annotation.tsv</code> file) and display the results of <em>Nextclade</em> or <em>Pangolin</em> clades/lineages.</li>
<li>Adjust the scale of the tree to be more intuitive. For example, instead of having the unit of the scale in years, we can change it to months. On the left menu, click <kbd>Time Scale</kbd> and change “Scale factor” to 12 (twelve months in a year). Then click <kbd>Scale Bar</kbd> and change the “Scale range” to 1. The scale now represents 1 month of time, which may be easier to interpret in this case.</li>
</ul>
<p>Note that there is uncertainty in the estimates of the internal node dates from <em>TimeTree</em> and these should be interpreted with some caution. The inference of the internal nodes will be better the more samples we have, and across a wider range of times. In our specific case we had samples all from a similar period of time, which makes our dating of internal nodes a little poorer than might be desired.</p>
<p>More precise tree dating may be achieved by using public sequences across a range of times or by collecting more samples over time. Time-scaled trees of this sort can therefore be useful to infer if there is a recent spread of a new clade in the population.</p>
</section>
<section id="missing-data-problematic-sites" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="missing-data-problematic-sites"><span class="header-section-number">7.6</span> Missing Data &amp; Problematic Sites</h2>
<p>So far, we have been using all of our assembled samples in the phylogenetic analysis. However, we know that some of these have poorer quality (for example the “IN01” sample from India had low genome coverage). Although, generally speaking, sequences with missing data are unlikely to substantially affect the phylogenetic results, their placement in the phylogeny will be more uncertain (since several variable sites may be missing data). Therefore, for phylogenetic analysis, it is best if we remove samples with low sequencing coverage, and instead focus on high-quality samples (e.g.&nbsp;with &gt;80% coverage).</p>
<p>A more serious issue affecting phylogenies is the presence of recurrent errors in certain positions of the genome. One of the regions with a higher prevalence of errors is the start and end of the consensus sequence, which also typically contains many missing data (see example in Figure 2). Therefore, it is common to <em>mask</em> the first and last few bases of the alignment, to avoid including spurious variable sites in the analysis.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sequence masking
</div>
</div>
<div class="callout-body-container callout-body">
<p>The term <strong>masking</strong> is often used to refer to the process of converting sequence bases to the ambiguous character ‘N’. You may come across this term in the documentation of certain tools, for example: “Positions with less than 20x depth of sequencing are masked.”</p>
<p>Masks are not limited to depth of sequencing. For example, <a href="https://ensemblgenomes.org/">reference genomes from ENSEMBL</a> are available with masked repeat or low-complexity sequences (e.g.&nbsp;around centromeres, transposon-rich regions, etc.).</p>
<p>The term <strong>soft masking</strong> is also used to refer to cases where, instead of using the ambiguous character ‘N’, sequences are masked with a lowercase. For example:</p>
<pre><code>&gt;seq_with_soft_masking
ACAGACTGACGCTGTcatgtatgtcgacGATAGGCTGATGGCGAGTGACTCGAG
&gt;seq_with_hard_masking
ACAGACTGACGCTGTNNNNNNNNNNNNNGATAGGCTGATGGCGAGTGACTCGAG</code></pre>
</div>
</div>
<p>Additionally, work by <a href="https://doi.org/10.1371/journal.pgen.1009175">Turakhia, de Maio, Thornlow, et al.&nbsp;(2020)</a> has identified several sites that show an unexpected mutation pattern. This includes, for example, mutations that unexpectedly occur multiple times in different parts of the tree (<a href="https://en.wikipedia.org/wiki/Homoplasy">homoplasies</a>) and often coincide with primer binding sites (from amplicon-based protocols) and can even be lab-specific (e.g.&nbsp;due to their protocols and data processing pipelines). The work from this team has led to the creation of a list of <a href="https://virological.org/t/masking-strategies-for-sars-cov-2-alignments/480">problematic sites</a>, which are recommended to be <em>masked</em> before running the phylogenetic analysis.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://journals.plos.org/plosgenetics/article/figure/image?size=inline&amp;id=10.1371/journal.pgen.1009175.g001" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Example of errors in phylogenetic inference due to recurrent sequencing errors. Source: <a href="https://journals.plos.org/plosgenetics/article/figure?id=10.1371/journal.pgen.1009175.g001">Figure 1 in Turakhia, de Maio, Thornlow et al.&nbsp;(2020)</a></figcaption>
</figure>
</div>
<p>So, let’s try to improve our alignment by masking the problematic sites, which are <a href="https://raw.githubusercontent.com/W-L/ProblematicSites_SARS-CoV2/master/problematic_sites_sarsCov2.vcf">provided as a VCF file</a>. This file also includes the first and last positions of the genome as targets for masking (positions 1–55 and 29804–29903, relative to the Wuhan-Hu-1 reference genome MN908947.3). The authors also provide a <a href="https://github.com/W-L/ProblematicSites_SARS-CoV2/blob/master/src/mask_alignment_using_vcf.py">python script</a> for masking a multiple sequence alignment. We have already downloaded these files to our course materials folder, so we can go ahead and use the script to mask our file:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> scripts/mask_alignment_using_vcf.py <span class="at">--mask</span> <span class="at">-v</span> resources/problematic_sites.vcf <span class="at">-i</span> results/mafft/uk_alignment.fa <span class="at">-o</span> results/mafft/uk_alignment_masked.fa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we open the output file with AliView, we can confirm that the positions specified in the VCF file have now been masked with the missing ‘N’ character.</p>
<p>We could then use this masked alignment for our tree-inference, just as we did before.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Using Python Scripts
</div>
</div>
<div class="callout-body-container callout-body">
<p>Bioinformaticians often write custom scripts for particular tasks. In this example, the authors of the “problematic sites” wrote a <em>Python</em> script that takes as input the FASTA file we want to mask as well as a VCF with the list of sites to be masked.</p>
<p>Python scripts are usually run with the <code>python</code> program and often accept options in a similar way to other command-line tools, using the syntax <code>--option</code> (this is not always the case, but most professionally written scripts follow this convention). To see how to use the script we can use the option <code>--help</code>. For our case, we could run:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> scripts/mask_alignment_using_vcf.py <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="exercises" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="exercises"><span class="header-section-number">7.7</span> Exercises</h2>
<div class="callout callout-style-default callout-exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Building phylogenies
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div>
<div class="callout-exercise">
<p>So far we have focused our analysis on the samples from the UK. In this exercise you will be able to practice these steps on the samples from India. The steps are similar to what we have done so far, and you can consult the materials in the sections above to go through each exercise.</p>
<p>In the following exercises, you can run the commands directly from the command line. But if you feel comfortable with <code>nano</code>, as a bonus, you can try to save the commands in a <em>shell script</em>.</p>
<ol type="1">
<li>Using <code>mafft</code>, produce a multiple-sequence alignment from the India consensus sequences in the file <code>data/india_consensus.fa</code>. Save the output in a file named <code>results/mafft/india_alignment.fa</code>.</li>
<li>Using <code>iqtree2</code>, infer a phylogenetic tree from this alignment. Save the output with prefix <code>results/iqtree/india</code>.
<ul>
<li>What substitution model did <em>IQ-Tree</em> infer as the most likely for the data?</li>
</ul></li>
<li>Using <em>FigTree</em>, visualise the inferred tree:
<ul>
<li>Open the <code>.tree</code> output file.</li>
<li>Import the annotation table <code>sample_annotation.tsv</code>.</li>
<li>Make the tip labels display the Nextclade clade instead of the sample names.</li>
<li>Highlight any clusters of the tree containing WHO variants of concern.</li>
</ul></li>
<li>Using <code>timetree</code>, re-scale the phylogeny using dates (the file <code>sample_annotation.tsv</code> can be used as input to <code>timetree</code> along with the previously-created phylogeny and alignments). Output the result to <code>results/treetime/india</code>
<ul>
<li>Open the <code>.nexus</code> output file in <em>FigTree</em>.</li>
<li>Make the node labels display the date inferred by <code>timetree</code>.</li>
</ul></li>
<li>Two samples in the time-scaled tree appear at the root of the tree: IN05 and IN33. But we would have expected the reference sample (MN908947.3) to be the root of the tree, as it was collected in Dec 2019.
<ul>
<li>Investigate what lineages these samples were assigned to.</li>
<li>Go to https://cov-lineages.org/lineage_list.html and check when those lineages were detected.</li>
<li>Is the collection date metadata for these samples compatible with the lineage information from the <em>Pangolin</em> website? Can you hypothesise what may have happened with these samples?</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-answer no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="callout-answer">
<p><strong>Question 1</strong></p>
<p>We run our alignment using the following command:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mafft</span> <span class="at">--6merpair</span> <span class="at">--maxambiguous</span> 0.2 <span class="at">--addfragments</span> data/india_consensus.fa resources/reference/sarscov2.fa <span class="op">&gt;</span> results/mafft/india_alignment.fa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We could optionally visualise our alignment using <em>AliView</em> to check that the alignment was successful.</p>
<p><strong>Question 2</strong></p>
<p>We can fit a maximum-likelihood tree using the following command:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">iqtree2</span> <span class="at">-s</span> results/mafft/india_alignment.fa <span class="at">--prefix</span> results/iqtree/india</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command prints a lot of output on the screen. We can see all this information (and more!) on the output file <code>results/iqtree/india.iqtree</code>, which contains a log of all the analysis done by the program. We could, for example, use the <code>less</code> program to look inside this file. When we do this, we can see the following:</p>
<pre><code>ModelFinder
-----------

Best-fit model according to BIC: GTR+F+I</code></pre>
<p>Which indicates that the substitution model used by <em>IQ-Tree</em> was “GTR+F+I”. This is the same model that was determined for the UK samples, and an explanation of this model is given in the materials above.</p>
<p><strong>Question 3</strong></p>
<p>Using <em>FigTree</em>:</p>
<ul>
<li>Go to <kbd><kbd>File</kbd> &gt; <kbd>Open…</kbd></kbd> and browse to the folder with the <em>IQ-Tree</em> output files.</li>
<li>Select the file with <code>india.treefile</code> and click <kbd>Open</kbd>.</li>
<li>Go to <kbd><kbd>File</kbd> &gt; <kbd>Import annotations…</kbd></kbd> and open the annotation file <code>sample_annotation.tsv</code>.</li>
<li>On the menu on the left, click <kbd>Tip Labels</kbd> and under “Display” choose the field “nextclade_clade”.</li>
</ul>
<p>On this tree, there is a small group of samples classified as “20I (Alpha; V1)”. These samples correspond to the <em>Alpha</em> variant of concern. To highlight these:</p>
<ul>
<li>Change the “Selection Mode” at the top to “Clade”.</li>
<li>Select the branch corresponding to the base of the group of samples classified as <em>Alpha</em>. This should highlight all those branches.</li>
<li>Click the “Highlight” button at the top and choose a colour.</li>
</ul>
<!-- 
The final result should look similar to what is shown here.

![TODO]() 
-->
<p><strong>Question 4</strong></p>
<p>The command to time-scale the tree is:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">treetime</span> <span class="at">--tree</span> results/iqtree/india.treefile <span class="at">--dates</span> sample_annotation.tsv <span class="at">--aln</span> results/mafft/india_alignment.fa <span class="at">--outdir</span> results/treetime/india</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once complete, we can open the <code>india.nexus</code> tree with <em>FigTree</em>. We can annotate the internal nodes of the tree with the dates inferred by <code>treetime</code> by clicking on the <kbd>Node Labels</kbd> menu on the left and selecting “Display” to be “date”.</p>
<!-- 
This should result in a tree similar to the one shown here.

![TODO]()
-->
<p><strong>Question 5</strong></p>
<p>To investigate this strange result, we open the <code>sample_annotation.tsv</code> file in our spreadsheet program. We can see the following information for these two samples:</p>
<pre><code>name    date           country  year     month  pango_lineage      nextclade_clade
IN05    2021-01-21   India    2021   1      A.23.1           19B
IN33    2021-01-21   India    2021   1      A.23.1           19B</code></pre>
<p>Both these samples were assigned to <em>Pango</em> lineage “A.23.1”. From the <a href="https://cov-lineages.org/lineage_list.html">cov-lineages.org</a> website we can see that these were detected as early as 2020-06-08.</p>
<p>However, our samples’ metadata indicate that these samples were collected in January 2021, that is 7 months after these samples were first detected globally.</p>
<p>This contractiction explains the strange result in our time-scaled tree. These samples will have mutations that are part of the older lineage “A”, but were annotated to be from 2021. So <code>treetime</code> put them down at the root of the tree.</p>
<p>This discrepancy could indicate an issue with the metadata collection, which perhaps is wrong. For example, it could be that these samples were collected months before January 2021, but only sequenced then. And by mistake the date of sequencing was recorded as the date of collection.</p>
<p>This is an example how important accurate metadata is for our analysis.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="summary" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="summary"><span class="header-section-number">7.8</span> Summary</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Points
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Methods for phylogenetic inference include <em>parsimony</em> and <em>maximum likelihood</em>. Maximum likelihood methods are preferred because they include more features of the evolutionary process. However, they are computationally more demanding than parsimony-based methods.</li>
<li>To build a phylogenetic tree we need a <em>multiple sequence alignment</em> of the sequences we want to infer a tree from.</li>
<li>In SARS-CoV-2, alignments are usually done against the Wuhan-Hu-1 reference genome.</li>
<li>We can use the software <code>mafft</code> to produce a multiple sequence alignment. The option <code>--addfragments</code> is used to produce an alignment against the reference genome.</li>
<li>The software <code>iqtree2</code> can be used for inferring trees from an alignment using maximum likelihood. This software supports a wide range of <em>substitution models</em> and a method to identify the model that maximizes the likelihood of the data.</li>
<li>Some of the substituion models that have been used to build global SARS-CoV-2 phylogenies are “GTR+G” and “GTR+I”.</li>
<li>We can time-scale trees using sample collection date information. The program <code>treetime</code> can be used to achieve this. For very large sample sizes (&gt;50,000 samples) the much faster program <em>Chronumental</em> can be used instead.</li>
<li>Before building a phylogeny, we should be careful to <em>mask</em> problematic sites that can lead to misleading placements of samples in the tree. The <a href="https://github.com/W-L/ProblematicSites_SARS-CoV2">SARS-CoV-2 Problematic Sites repository</a> provides with an updated list of sites that should be masked.</li>
</ul>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../materials/02-isolates/03-lineages.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lineages and variants</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../materials/03-case_studies/01-switzerland.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Switzerland (Nanopore)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Licensed <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> <img src="https://creativecommons.org/images/deed/cc_icon_black_x2.png" class="img-fluid" width="25"> Bioinformatics Training Facility</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>